# Formula Autonomous System Configuration
# Combined configuration file for all subsystems
# Author: Jiwon Seok (jiwonseok@hanyang.ac.kr)
# Date: 2025-07-25

system:
  main_loop_rate: 1000.0 # [Hz]

# ===========================================
# Perception Parameters
# ===========================================
perception:
  # ========== LiDAR Parameters ============
  
  # LiDAR ROI extraction parameters
  lidar_roi_extraction:
    x_min: 0.0
    x_max: 50.0
    y_min: -30.0
    y_max: 30.0
    z_min: -10.0
    z_max: 10.0

  # RANSAC ground plane fitting parameters
  lidar_ground_removal:
    ransac_iterations: 30
    ransac_distance_threshold: 0.01

  # DBSCAN clustering parameters
  lidar_clustering:
    dbscan_eps: 0.5
    dbscan_min_points: 2

  # Cone geometric constraints
  lidar_cone_detection:
    cone_min_height: 0.1
    cone_max_height: 0.5
    cone_min_radius: 0.00
    cone_max_radius: 0.7
    cone_min_points: 1

  # LiDAR position relative to vehicle base (meters, degrees)
  lidar_extrinsics:
    translation_x: 0.6
    translation_y: 0.0
    translation_z: 0.1
    rotation_roll: 0.0
    rotation_pitch: 0.0
    rotation_yaw: 0.0

  # ========= Camera Parameters ============

  # Camera intrinsic parameters (pixels)
  camera_intrinsics:
    # 640x480, horizontal FOV: 90 deg: focal length = 320.0
    focal_length_x: 320.0
    focal_length_y: 320.0
    principal_point_x: 320.0
    principal_point_y: 240.0

  # Camera 1 (Left) position relative to vehicle base (meters, degrees)
  camera1_extrinsics:
    translation_x: -0.43
    translation_y: 0.15
    translation_z: 0.82
    rotation_roll: 0.0
    rotation_pitch: 0.0
    rotation_yaw: 0.0

  # Camera 2 (Right) position relative to vehicle base (meters, degrees)
  camera2_extrinsics:
    translation_x: -0.43
    translation_y: -0.15
    translation_z: 0.82
    rotation_roll: 0.0
    rotation_pitch: 0.0
    rotation_yaw: 0.0

  # Image preprocessing settings
  camera_image_processing:
    enable_preprocessing: false
    gaussian_blur_sigma: 1.0
    bilateral_filter_diameter: 9

  camera_hsv_window_size:
    window_size: 15

  # HSV thresholds for yellow cone detection
  camera_hsv_yellow:
    hue_min: 18
    hue_max: 40
    saturation_min: 36
    value_min: 100

  # HSV thresholds for blue cone detection
  camera_hsv_blue:
    hue_min: 95
    hue_max: 110
    saturation_min: 90
    value_min: 100

  # HSV thresholds for orange cone detection
  camera_hsv_orange:
    hue_min: 10
    hue_max: 15
    saturation_min: 100
    value_min: 100

# ===========================================
# Localization Parameters
# ===========================================
localization:
  # Reference WGS84 Position
  # if user defined position is true then use ref_wgs84_latitude, ref_wgs84_longitude, ref_wgs84_altitude
  # if not then use initial gps position as reference position
  use_user_defined_ref_wgs84_position: true
  ref_wgs84_latitude: 47.641467991978416
  ref_wgs84_longitude: -122.14016501105924
  ref_wgs84_altitude: 0.0
    
  # Velocity Estimation
  gps_correction_gain: 0.1

# ===========================================
# Mapping Parameters
# ===========================================
mapping:
  # Local mapping
  cone_memory_search_radius: 10.0
  cone_memory_association_threshold: 1.0

  # Cone sorting parameters for lane generation
  max_connection_distance: 15.0
  direction_weight: 0.5 # Path direction consistency weight (0.0 ~ 1.0)

  # Cone map refinement parameters
  max_dist_from_lane: 2.0

# ===========================================
# Planning Parameters
# ===========================================
planning:
  trajectory_generation:
    # Parameters used during the MAPPING lap
    mapping_mode:
      lookahead_distance: 3.0
      waypoint_spacing: 0.2
      max_speed: 3.0
      lane_offset: 2.0

    # Parameters used during the RACING laps
    racing_mode:
      lookahead_distance: 15.0
      waypoint_spacing: 0.5
      max_speed: 10.0
      min_speed: 3.0
      curvature_gain: 1.5

  behavioral_logic:
    # Lap Counting & Race Logic
    total_laps: 10

# ===========================================
# Control Parameters
# ===========================================
control:
  ControllerSelection:
    # lateral_controller_type: "PurePursuit", "Stanley"
    lateral_controller_type: "Stanley"

  PurePursuit:
    lookahead_distance: 5.0
    max_steer_angle: 1.0

  Stanley:
    k_gain: 0.9
    k_gain_curvature_boost: 1.5
    alpha: 1.0 # (stability(0.0) <---> response(1.0))

  # PID Speed Control Parameters
  SpeedControl:
    pid_kp: 0.3
    pid_ki: 0.0
    pid_kd: 0.01
    max_throttle: 0.4

    # Steering-based speed dampening gain
    steering_based_speed_gain: 0.0 # Higher value means more aggressive slowing on turns.

  Vehicle:
    wheel_base: 1.55